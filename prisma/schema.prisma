generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())

  dayEntries DayEntry[]
  timeBlocks TimeBlock[]
}

model DayEntry {
  id            String   @id @default(cuid())
  userId        String
  date          String   // YYYY-MM-DD
  wakeTime      String   // HH:mm
  dayLengthHours Int     @default(15)

  topTasks      Json     @default("[]") // [{id,text,done}]
  callsBooked   Int      @default(0)
  callsConducted Int     @default(0)
  distractions  String   @default("")
  improvements  String   @default("")

  endOfDay      Json?    // {hoursWorked,focusPct,outputPct,dayThoughts,completedAt}

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  timeBlocks    TimeBlock[]

  @@unique([userId, date])
  @@index([userId, date])
}

model TimeBlock {
  id         String   @id @default(cuid())
  userId     String
  dayEntryId String
  startTime  String   // HH:mm
  endTime    String   // HH:mm
  planned    String   @default("")
  actual     String   @default("")
  status     String   @default("empty") // empty|planned|in_progress|done|skipped
  updatedAt  DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  dayEntry  DayEntry @relation(fields: [dayEntryId], references: [id], onDelete: Cascade)

  @@index([userId, dayEntryId])
  @@unique([dayEntryId, startTime])
}

